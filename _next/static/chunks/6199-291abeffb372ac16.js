"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6199],{16199:function(e,r,t){t.d(r,{F:function(){return c}});var n=t(67294),a=t(33299),s=t(71725),c=function(){var e="authenticated"===(0,a.useSession)().status,r=(0,s.M)(),t=r.initializeFavorites,c=r.isInitialized;return(0,n.useEffect)(function(){e&&!c&&t()},[e,t,c]),{isAuthenticated:e}}},42611:function(e,r,t){var n,a=t(59499),s=t(50029),c=t(87794),u=t.n(c),o=t(62842),i=t.n(o),p=t(24931),l=t(73020),f=t(23368),v=t(7764),d=t(83454);function h(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function m(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?h(Object(t),!0).forEach(function(r){(0,a.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):h(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var g=(n=(0,s.Z)(u().mark(function e(r){var t,n,a;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(v.Z.API_URL,"/auth/refresh-token"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:r.refreshToken})});case 3:return n=e.sent,e.next=6,n.json();case 6:return a=e.sent,e.abrupt("return",m(m({},r),{},{accessToken:a.accessToken,accessTokenExpires:Date.now()+864e5,refreshToken:null!==(t=a.refreshToken)&&void 0!==t?t:r.refreshToken}));case 10:return e.prev=10,e.t0=e.catch(0),console.error("RefreshAccessTokenError",e.t0),e.abrupt("return",m(m({},r),{},{error:"RefreshAccessTokenError"}));case 14:case"end":return e.stop()}},e,null,[[0,10]])})),function(e){return n.apply(this,arguments)}),x={providers:[(0,p.Z)({name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"},remember:{label:"Remember",type:"boolean"}},authorize:function(e){return(0,s.Z)(u().mark(function r(){var t,n;return u().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,!(!(null!=e&&e.email)||!(null!=e&&e.password))){r.next=3;break}throw Error("Email v\xe0 mật khẩu l\xe0 bắt buộc");case 3:return r.next=5,fetch("".concat(v.Z.API_URL,"/auth/signin"),{method:"POST",body:JSON.stringify({email:e.email,password:e.password,remember:"true"===e.remember}),headers:{"Content-Type":"application/json"}});case 5:return t=r.sent,r.next=8,t.json();case 8:if(n=r.sent,!(t.ok&&n)){r.next=11;break}return r.abrupt("return",{id:n.user.id,email:n.user.email,name:n.user.name||null,avatar:n.user.avatar||null,accessToken:n.accessToken,refreshToken:n.refreshToken,emailVerified:n.user.emailVerified,provider:"credentials",role:n.user.role,plan:n.user.plan});case 11:throw Error(n.error||"Invalid credentials");case 14:throw r.prev=14,r.t0=r.catch(0),Error(r.t0.message);case 17:case"end":return r.stop()}},r,null,[[0,14]])}))()}}),(0,l.Z)({clientId:d.env.GOOGLE_ID,clientSecret:d.env.GOOGLE_SECRET}),(0,f.Z)({clientId:d.env.FACEBOOK_ID,clientSecret:d.env.FACEBOOK_SECRET})],callbacks:{jwt:function(e){return(0,s.Z)(u().mark(function r(){var t,n,a,s,c,o,i,p,l,f,d,h;return u().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(t=e.token,n=e.user,a=e.account,s=e.trigger,c=e.session,"update"===s&&(null!=c&&null!==(o=c.user)&&void 0!==o&&o.emailVerified&&(t.emailVerified=c.user.emailVerified),null!=c&&null!==(i=c.user)&&void 0!==i&&i.name&&(t.name=c.user.name),null!=c&&null!==(p=c.user)&&void 0!==p&&p.avatar&&(t.avatar=c.user.avatar),null!=c&&null!==(l=c.user)&&void 0!==l&&l.email&&(t.email=c.user.email),null!=c&&null!==(f=c.user)&&void 0!==f&&f.plan&&(t.plan=c.user.plan)),n&&(t.provider=n.provider,t.accessToken=n.accessToken,t.avatar=n.avatar,t.refreshToken=n.refreshToken,t.accessTokenExpires=Date.now()+(n.remember?6048e5:864e5),t.emailVerified=n.emailVerified,t.role=n.role,t.plan=n.plan),(null==a?void 0:a.type)!=="oauth"){r.next=20;break}return r.prev=4,r.next=7,fetch("".concat(v.Z.API_URL,"/auth/social-auth"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t.email,name:t.name,avatar:t.picture,provider:a.provider,providerAccountId:a.providerAccountId})});case 7:return d=r.sent,r.next=10,d.json();case 10:if(h=r.sent,d.ok){r.next=13;break}throw Error(h.error||"Lỗi khi đăng nhập bằng Google hoặc Facebook, vui l\xf2ng thử lại");case 13:d.ok&&(t.avatar=h.user.avatar,t.name=h.user.name,t.email=h.user.email,t.accessToken=h.accessToken,t.refreshToken=h.refreshToken,t.accessTokenExpires=Date.now()+864e5,t.emailVerified=h.user.emailVerified,t.provider=h.user.provider,t.role=h.user.role,t.plan=h.user.plan),r.next=20;break;case 16:return r.prev=16,r.t0=r.catch(4),console.error("Social auth error next-auth:",r.t0),r.abrupt("return",m(m({},t),{},{error:r.t0.message}));case 20:if(!("number"==typeof t.accessTokenExpires&&Date.now()<t.accessTokenExpires)){r.next=22;break}return r.abrupt("return",t);case 22:return r.abrupt("return",g(t));case 23:case"end":return r.stop()}},r,null,[[4,16]])}))()},session:function(e){return(0,s.Z)(u().mark(function r(){var t,n;return u().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.session,n=e.token,r.abrupt("return",m(m({},t),{},{user:{email:n.email,name:n.name||null,avatar:n.avatar||null,emailVerified:n.emailVerified,provider:n.provider,role:n.role,plan:n.plan},accessToken:n.accessToken,remember:n.remember}));case 2:case"end":return r.stop()}},r)}))()}},pages:{signIn:"/login",error:"/auth/error"},secret:d.env.NEXTAUTH_SECRET,session:{strategy:"jwt",maxAge:2592e3},jwt:{maxAge:2592e3}};i()(x)},8226:function(e,r,t){t(87794),t(21379),t(42611),t(7764)},30731:function(e,r,t){t.d(r,{Aq:function(){return y},DV:function(){return Z},MQ:function(){return j},Nk:function(){return E},P9:function(){return P},Q5:function(){return O},Tk:function(){return k},Uq:function(){return I},YR:function(){return T},_Y:function(){return w},vV:function(){return S}});var n,a,s,c,u,o,i,p,l,f,v,d=t(50029),h=t(87794),m=t.n(h);t(8226);var g=t(63909),x=t(87066),b=t(7764),k=(n=(0,d.Z)(m().mark(function e(){var r;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.Z.get("/templates/all");case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}},e)})),function(){return n.apply(this,arguments)}),w=(a=(0,d.Z)(m().mark(function e(){var r,t,n,a,s=arguments;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>0&&void 0!==s[0]?s[0]:{},e.prev=1,t=new URLSearchParams,r.limit&&t.append("limit",r.limit.toString()),r.lastKey&&t.append("lastKey",r.lastKey),r.category&&t.append("category",r.category),r.search&&t.append("search",r.search),r.status&&t.append("status",r.status),n="/admin/templates".concat(t.toString()?"?".concat(t.toString()):""),e.next=11,g.Z.get(n);case 11:return a=e.sent,e.abrupt("return",a.data);case 15:return e.prev=15,e.t0=e.catch(1),console.error("Error fetching admin templates:",e.t0),e.abrupt("return",{success:!1,templates:[],message:"Kh\xf4ng thể tải danh s\xe1ch template"});case 19:case"end":return e.stop()}},e,null,[[1,15]])})),function(){return a.apply(this,arguments)}),y=(s=(0,d.Z)(m().mark(function e(r){var t;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.Z.delete("/admin/templates/".concat(r));case 3:return t=e.sent,e.abrupt("return",t.data);case 7:return e.prev=7,e.t0=e.catch(0),console.error("Error deleting template:",e.t0),e.abrupt("return",{success:!1,message:"Kh\xf4ng thể x\xf3a template"});case 11:case"end":return e.stop()}},e,null,[[0,7]])})),function(e){return s.apply(this,arguments)}),E=(c=(0,d.Z)(m().mark(function e(r,t){var n;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.Z.patch("/admin/templates/".concat(r,"/status"),{status:t});case 3:return n=e.sent,e.abrupt("return",n.data);case 7:return e.prev=7,e.t0=e.catch(0),console.error("Error updating template status:",e.t0),e.abrupt("return",{success:!1,template:null,message:"Kh\xf4ng thể cập nhật trạng th\xe1i template"});case 11:case"end":return e.stop()}},e,null,[[0,7]])})),function(e,r){return c.apply(this,arguments)}),T=(u=(0,d.Z)(m().mark(function e(r){var t;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,x.default.post("".concat(b.Z.API_URL,"/templates/").concat(r,"/views"));case 3:return t=e.sent,e.abrupt("return",t.data);case 7:return e.prev=7,e.t0=e.catch(0),console.error("Error increasing template views:",e.t0),e.abrupt("return",{success:!1,message:"Kh\xf4ng thể cập nhật số lượt xem template"});case 11:case"end":return e.stop()}},e,null,[[0,7]])})),function(e){return u.apply(this,arguments)}),Z=(o=(0,d.Z)(m().mark(function e(r){var t;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,x.default.post("".concat(b.Z.API_URL,"/templates/").concat(r,"/usages"));case 3:return t=e.sent,e.abrupt("return",t.data);case 7:return e.prev=7,e.t0=e.catch(0),console.error("Error increasing template usages:",e.t0),e.abrupt("return",{success:!1,message:"Kh\xf4ng thể cập nhật số lượt sử dụng template"});case 11:case"end":return e.stop()}},e,null,[[0,7]])})),function(e){return o.apply(this,arguments)}),I=(i=(0,d.Z)(m().mark(function e(r){var t;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.Z.post("/users/favorites/templates",{templateId:r});case 3:return t=e.sent,e.abrupt("return",t.data);case 7:return e.prev=7,e.t0=e.catch(0),console.error("Error adding template to favorites:",e.t0),e.abrupt("return",{success:!1,message:"Kh\xf4ng thể th\xeam v\xe0o danh s\xe1ch y\xeau th\xedch"});case 11:case"end":return e.stop()}},e,null,[[0,7]])})),function(e){return i.apply(this,arguments)}),S=(p=(0,d.Z)(m().mark(function e(r){var t;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.Z.delete("/users/favorites/templates/".concat(r));case 3:return t=e.sent,e.abrupt("return",t.data);case 7:return e.prev=7,e.t0=e.catch(0),console.error("Error removing template from favorites:",e.t0),e.abrupt("return",{success:!1,message:"Kh\xf4ng thể x\xf3a khỏi danh s\xe1ch y\xeau th\xedch"});case 11:case"end":return e.stop()}},e,null,[[0,7]])})),function(e){return p.apply(this,arguments)}),O=(l=(0,d.Z)(m().mark(function e(){var r,t,n,a=arguments;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>0&&void 0!==a[0]?a[0]:{},e.prev=1,t=new URLSearchParams,r.limit&&t.append("limit",r.limit.toString()),r.lastEvaluatedKey&&t.append("lastEvaluatedKey",r.lastEvaluatedKey),e.next=7,g.Z.get("/users/favorites/templates".concat(t.toString()?"?".concat(t.toString()):""));case 7:return n=e.sent,e.abrupt("return",n.data);case 11:return e.prev=11,e.t0=e.catch(1),console.error("Error fetching favorite templates:",e.t0),e.abrupt("return",{success:!1,templates:[],message:"Kh\xf4ng thể lấy danh s\xe1ch template y\xeau th\xedch"});case 15:case"end":return e.stop()}},e,null,[[1,11]])})),function(){return l.apply(this,arguments)}),P=(f=(0,d.Z)(m().mark(function e(){var r;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.Z.get("/users/favorites/templates/ids");case 3:return r=e.sent,e.abrupt("return",r.data);case 7:return e.prev=7,e.t0=e.catch(0),console.error("Error fetching favorite template IDs:",e.t0),e.abrupt("return",{success:!1,templateIds:[],message:"Kh\xf4ng thể lấy danh s\xe1ch ID template y\xeau th\xedch"});case 11:case"end":return e.stop()}},e,null,[[0,7]])})),function(){return f.apply(this,arguments)}),j=(v=(0,d.Z)(m().mark(function e(r){var t,n,a,s,c=arguments;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=c.length>1&&void 0!==c[1]?c[1]:{},e.prev=1,n=new URLSearchParams,t.page&&n.append("page",t.page.toString()),t.pageSize&&n.append("pageSize",t.pageSize.toString()),a="".concat(b.Z.API_URL,"/templates/category/").concat(r).concat(n.toString()?"?".concat(n.toString()):""),e.next=8,x.default.get(a);case 8:return s=e.sent,e.abrupt("return",s.data);case 12:return e.prev=12,e.t0=e.catch(1),console.error("Error fetching templates by category:",e.t0),e.abrupt("return",{success:!1,templates:[],pagination:{total:0,currentPage:t.page||1,pageSize:t.pageSize||10},message:"Kh\xf4ng thể tải danh s\xe1ch template theo danh mục"});case 16:case"end":return e.stop()}},e,null,[[1,12]])})),function(e){return v.apply(this,arguments)})},71725:function(e,r,t){t.d(r,{M:function(){return i}});var n=t(27812),a=t(50029),s=t(87794),c=t.n(s),u=t(31993),o=t(30731),i=(0,u.U)(function(e,r){var t,s,u,i;return{favoriteIds:[],isLoading:!1,isInitialized:!1,initializeFavorites:(t=(0,a.Z)(c().mark(function t(){var n;return c().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!r().isInitialized){t.next=2;break}return t.abrupt("return");case 2:return e({isLoading:!0}),t.prev=3,t.next=6,(0,o.P9)();case 6:(n=t.sent).success&&e({favoriteIds:n.templateIds,isInitialized:!0}),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),console.error("Error initializing favorite templates:",t.t0);case 13:return t.prev=13,e({isLoading:!1}),t.finish(13);case 16:case"end":return t.stop()}},t,null,[[3,10,13,16]])})),function(){return t.apply(this,arguments)}),addFavorite:(s=(0,a.Z)(c().mark(function r(t){return c().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,e(function(e){return{favoriteIds:[].concat((0,n.Z)(e.favoriteIds),[t])}}),r.next=4,(0,o.Uq)(t);case 4:if(r.sent.success){r.next=8;break}return e(function(e){return{favoriteIds:e.favoriteIds.filter(function(e){return e!==t})}}),r.abrupt("return",!1);case 8:return r.abrupt("return",!0);case 11:return r.prev=11,r.t0=r.catch(0),console.error("Error adding template to favorites:",r.t0),e(function(e){return{favoriteIds:e.favoriteIds.filter(function(e){return e!==t})}}),r.abrupt("return",!1);case 16:case"end":return r.stop()}},r,null,[[0,11]])})),function(e){return s.apply(this,arguments)}),removeFavorite:(u=(0,a.Z)(c().mark(function r(t){return c().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,e(function(e){return{favoriteIds:e.favoriteIds.filter(function(e){return e!==t})}}),r.next=4,(0,o.vV)(t);case 4:if(r.sent.success){r.next=8;break}return e(function(e){return{favoriteIds:[].concat((0,n.Z)(e.favoriteIds),[t])}}),r.abrupt("return",!1);case 8:return r.abrupt("return",!0);case 11:return r.prev=11,r.t0=r.catch(0),console.error("Error removing template from favorites:",r.t0),e(function(e){return{favoriteIds:[].concat((0,n.Z)(e.favoriteIds),[t])}}),r.abrupt("return",!1);case 16:case"end":return r.stop()}},r,null,[[0,11]])})),function(e){return u.apply(this,arguments)}),toggleFavorite:(i=(0,a.Z)(c().mark(function e(t){var n,a,s,u;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=(n=r()).isFavorite,s=n.addFavorite,u=n.removeFavorite,!a(t)){e.next=8;break}return e.next=5,u(t);case 5:case 10:return e.abrupt("return",e.sent);case 8:return e.next=10,s(t);case 11:case"end":return e.stop()}},e)})),function(e){return i.apply(this,arguments)}),isFavorite:function(e){return r().favoriteIds.includes(e)}}})}}]);